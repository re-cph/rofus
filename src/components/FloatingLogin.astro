---
import Button from "./Button.astro";
---

<script type="module">
  var loginContainer = document.querySelector(".login-container");
  var loginHeader = document.querySelector(".login-header");
  var loginDescWrapper = document.querySelector(
    ".login-container-description-wrapper",
  );
  var loginDesc = document.querySelector(".login-container__description");

  function handleIntersection(entries) {
    entries.forEach(function (entry) {
      if (!entry.isIntersecting) {
        loginHeader.classList.add("login-header--sticky");
      } else {
        loginHeader.classList.remove("login-header--sticky");
      }
    });
  }

  var observer = new IntersectionObserver(handleIntersection, {
    threshold: 1,
  });

  var initialHeight = loginDescWrapper.clientHeight + 16; // padding
  loginDesc.style.height = initialHeight + "px";
  function slide() {
    var scrolled = document.documentElement["scrollTop"];
    var height =
      initialHeight -
      (initialHeight + 32 * 2) * (scrolled / window.innerHeight);
    var loginDescWrapperHeight = height + 32;
    loginDescWrapper.style.height = loginDescWrapperHeight + "px";

    var loginContainerHeight = 120 + height + 32;
    loginContainer.style.height = loginContainerHeight + "px";

    var isSticky = loginHeader.classList.contains("login-header--sticky");
    if (isSticky || loginDescWrapperHeight < (isSticky ? 120 : 0)) {
      loginHeader.classList.add("login-header--fully-rounded");
    } else {
      loginHeader.classList.remove("login-header--fully-rounded");
    }
  }

  var isDesktop = function () {
    return window.outerWidth > 660;
  };

  function initLoginContainer() {
    observer.unobserve(loginContainer);
    if (isDesktop()) {
      observer.observe(loginContainer);
    } else {
      loginHeader.classList.remove("login-header--sticky");
      loginDescWrapper.style.height = "auto";
      loginDesc.style.height = "auto";
    }
  }

  window.onscroll = function () {
    if (isDesktop()) {
      slide();
    }
  };

  window.onresize = function () {
    initLoginContainer();
  };

  initLoginContainer();
</script>

<div
  class="absolute left-4 md:left-auto bottom-4 md:bottom-8 right-4 md:right-8 md:w-[310px] bg-white rounded-3xl overflow-hidden z-20"
>
  <!--  login-container--desktop -->
  <a
    class="block bg-primary text-white px-5 pt-8 pb-5 no-underline"
    target="_blank"
    href="https://rofusweb.spillemyndigheden.dk/public/rofus/"
  >
    <img src="/images/logo_toggle.png" class="w-[200px] mb-5" />
    <div class="flex justify-between items-center">
      <div class="text-xs font-semibold">Log på ROFUS med MitID</div>

      <img class="w-[13px]" src="/images/digital_signatur_lock.png" alt="" />
    </div>
  </a>

  <div class="px-4 py-6 bg-white text-sm">
    <strong>
      I ROFUS kan du frivilligt udelukke dig selv fra onlinespil, fysiske
      kasinoer og væddemål i fysiske butikker i Danmark.
    </strong>

    <ul class="list-disc space-y-2 pl-10 my-4">
      <li>Tag en 24 timers spillepause</li>
      <li>Midlertidig udelukkelse i 1, 3 eller 6 måneder</li>
      <li>Endelig udelukkelse</li>
    </ul>

    <Button
      href="https://rofusweb.spillemyndigheden.dk/public/rofus/"
      className="my-5 w-full"
    >
      Registrér med MitID
    </Button>

    <p class="text-xs text-center leading-relaxed">
      Vær opmærksom på, at Spillemyndigheden tager forbehold for eventuelle
      tekniske fejl i ROFUS og kan således ikke holdes ansvarlig for dette
    </p>
  </div>
</div>
